!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t,n){"use strict";var r="undefined"!=typeof window,o=[];r&&(window.debug_routes=o),t.a=o},function(e,t,n){"use strict";var r="undefined"!=typeof window,o=Object.create(null);r&&(window.debug_cache=o),t.a=o},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return c(e)||i(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}function c(e){if(Array.isArray(e))return e}function u(){return"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function s(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"==typeof e?e.split(",").indexOf(t)>-1:e instanceof RegExp&&e.test(t)}function f(e,t){var n=window.location.pathname;return"hash"===t?window.location.hash.replace(/^#\//,""):(e&&0===n.indexOf(e)&&(n=n.slice(e.length)),(n||"/")+window.location.search+window.location.hash)}function l(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}function h(e,t){return"string"==typeof t||"number"==typeof t?h(e,e[t]):t}function d(e){return"[object Object]"===m.call(e)}function p(e){if(d(e)){var t={};for(var n in e)t[n]=p(e[n]);return t}return Array.isArray(e)?e.slice():e}function y(e){e.forEach(function(e){var t=p(e.meta);d(e.meta)&&Object.defineProperty(e.meta,"_default",{configurable:!1,enumerable:!1,writable:!1,value:t}),e.children&&y(e.children)})}function b(e){var t="",n="",r=e.indexOf("#");r>=0&&(t=e.slice(r),e=e.slice(0,r));var o=e.indexOf("?");return o>=0&&(n=e.slice(o+1),e=e.slice(0,o)),{pathStr:e,queryStr:n,hashStr:t}}n.d(t,"i",function(){return w}),t.c=u,t.f=s,t.e=f,t.h=l,t.d=h,t.a=p,t.b=y,n.d(t,"g",function(){return k});var v="undefined"!=typeof window,m=Object.prototype.toString,g=v&&function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}(),w=function(){if(!g)return!1;if(history.replaceState(Object.assign({_debug:"ok"},history.state),null),history.state){var e=Object.assign({},history.state);return delete e._debug,history.replaceState(e,null),!0}return!1}(),O=function(e){var t=Object.create(null),n=b(e),r=n.pathStr,a=n.queryStr,i=n.hashStr;return a&&a.split("&").forEach(function(e){var n=e.split("="),r=o(n,2),a=r[0],i=r[1];t[a]=decodeURIComponent(i)}),{path:r,query:t,hash:i}},j=function(e){switch(r(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},x=function(e){var t="";return Object.keys(e).forEach(function(n,r){var o=e[n];0!==r&&(t+="&"),t+=n+"="+encodeURIComponent(j(o))}),t},k=function(e){"string"==typeof e&&(e={path:e,query:Object.create(null)});var t=e,n=t.path,r=t.query,o=O(n),a=Object.assign({},o.query,r),i=x(a);return i=i?"?"+i:"",o.path+i+o.hash}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),o=n(5),a=n(0),i=n(1),c=n(6),u=n(2),s=Object.create(null),f=!1;t.default={install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.router,f=t.keyName,l=void 0===f?"key":f,h=t.isServer,d=void 0!==h&&h,p=t.maxPage,y=void 0===p?10:p,b=t.beforeLocationChange;if(d)return void e.component("feb-alive",Object(o.a)());if(e.component("feb-alive",Object(r.a)(l,y)),!n)return void console.warn("need options: router");window.debug_metaMap=s;var v=n.options.routes;Object(u.b)(v);var m=new e,g=Object(c.a)(m,l),w=n.replace,O="",j=!1;n.replace=function(){j=!0,w.apply(this,arguments)};var x=n.history.ensureURL;n.history.ensureURL=function(){x.apply(this,arguments);var t=n.febRecord.from,r=n.febRecord.to;e.location.recoverMeta(t,r),g.record(r,t,j),j=!1},n.beforeEach(function(e,t,r){Object.assign(e.meta,e.meta._default),n.febRecord={to:e,from:t,replaceFlag:j},r()}),e.location=e.prototype.$location={to:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(!e)return void console.warn("FEB-ALIVE: 跳转链接不能为空");e=Object(u.g)(e),e=e.replace(new RegExp("^".concat(location.origin)),"");var r=n.match(e),o=r.matched;if(!o.length||"*"===o[0].path||t)return void(window.location.href=e);if(!b)return void n.push({path:e});b(route,function(t){!1===t?window.location.href=e:n.push({path:e})})}catch(e){console.log(e)}},replace:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(!e)return void console.warn("FEB-ALIVE: 跳转链接不能为空");e=Object(u.g)(e),e=e.replace(new RegExp("^".concat(location.origin)),"");var r=n.match(e),o=r.matched;if(!o.length||"*"===o[0].path||t)return void window.location.replace(e);if(!b)return void n.replace({path:e});b(route,function(t){!1===t?window.location.replace(e):n.replace({path:e})})}catch(e){console.log(e)}},go:function(e){n.go(e)},back:function(){n.back()},forward:function(){n.forward()},recoverMeta:function(e,t){var r=e.path===t.path,o=e.meta,a=t.meta,i=history.state[l],c=n.febRecord.replaceFlag;return!o.disableCache&&O&&(s[O]=Object(u.a)(o)),O=i,a.fromCache=!1,(!c||c&&r)&&s[i]&&(Object.assign(a,s[i]),a.fromCache=!0),a},getRoutes:function(){return a.a.slice()},getCache:function(){return i.a},getKey:function(){return history.state&&history.state[l]},cleanRoutes:function(){return g.reset()},on:function(e,t){m.$on(e,t)},once:function(e,t){m.$once(e,t)},off:function(e,t){m.$off(e,t)}}},resetHistory:function(){if("undefined"!=typeof history&&!f){var e=history.replaceState.bind(history);history.replaceState=function(t,n,r){e(Object.assign({},history.state,t),n,r)},f=!0}}}},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=n(0),a=n(1),i=n(2);t.a=function(e,t){return{name:"feb-alive",abstract:!0,methods:{cacheClear:function(){if(t&&this.keys.length>parseInt(t)){var e=this.keys[0],n=this.cache[e];n&&n.componentInstance&&n.componentInstance.$destroy(),Object(i.h)(this.keys,e),delete this.cache[e]}for(var r in this.cache)if(!Object(i.f)(o.a,r)){var a=this.cache[r];a&&a.componentInstance&&a.componentInstance.$destroy(),Object(i.h)(this.keys,r),delete this.cache[r]}}},created:function(){this.cache=Object.create(null),this.keys=[]},render:function(){var t=this.$slots.default?this.$slots.default[0]:null,n=this.$route.meta.disableCache;if(!i.i)return t;if(!history.state||!history.state[e]){var o=r({},e,Object(i.c)()),c=Object(i.e)();history.replaceState(o,null,c)}if(!history.state)return t;if(n)return t;if(t){var u=this.cache,s=this.keys,f=history.state[e],l=this.$router.febRecord,h=l.from,d=l.to,p=this.$parent,y=0,b=Object.create(null);for(t&&(t.data.febAlive=!0);p&&p._routerRoot!==p;)p.$vnode&&p.$vnode.data.febAlive&&y++,p=p.$parent;if(a.a[y]=u,d.matched.length<y+1)return null;h.matched[y]===d.matched[y]&&h.matched.slice(-1)[0]!==d.matched.slice(-1)[0]?(u[f]=u[f]||this.keys[this.keys.length-1],b=Object(i.d)(u,u[f]),b?(t.key=b.key,Object(i.h)(s,f),s.push(f)):(this.cacheClear(),u[f]=t,s.push(f))):(t.key="__febAlive-".concat(f,"-").concat(t.tag),b=Object(i.d)(u,f),b&&t.tag===b.tag?(t.key=b.key,t.componentInstance=b.componentInstance,Object(i.h)(s,f),s.push(f)):(this.cacheClear(),u[f]=t,s.push(f))),t.data.keepAlive=!0}return t},destroyed:function(){for(var e in this.cache){var t=this.cache[e];t&&t.componentInstance.$destroy()}this.keys=[],this.cache={}}}}},function(e,t,n){"use strict";t.a=function(){return{name:"feb-alive",abstract:!0,render:function(){return this.$slots.default?this.$slots.default[0]:null}}}},function(e,t,n){"use strict";var r=n(0);t.a=function(e,t){var n=function(t,n,o){var a={route:n},i={route:o},c=r.a;i.name=c[c.length-1]||null,a.name=t,c.push(t),e.$emit("forward",a,i)},o=function(t,n,o){var a={route:n},i={route:o},c=r.a;i.name=c[c.length-1],a.name=c[c.length-1-t],c.splice(r.a.length-t,t),e.$emit("back",a,i)},a=function(t,n,o){var a={route:n},i={route:o},c=r.a;i.name=c[c.length-1]||null,a.name=t,c.splice(r.a.length-1,1,t),e.$emit("replace",a,i)},i=function(t,n){var o={route:t},a={route:n},i=r.a;o.name=a.name=i[i.length-1],e.$emit("refresh",o,a)},c=function(){r.a.splice(0,r.a.length),e.$emit("reset")};return{record:function(e,c,u){if(history.state){var s=history.state[t];if(s)if(u)a(s,e,c);else{var f=r.a.lastIndexOf(s);-1===f?n(s,e,c):f===r.a.length-1?i(e,c):o(r.a.length-1-f,e,c)}}},reset:c}}}])});
//# sourceMappingURL=feb-alive.js.map